<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Analisi Completa Utenti Naga Har (Report Finale 2002-2025)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8fafc;
        }
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 1200px;
            margin-left: auto;
            margin-right: auto;
            height: 450px;
            max-height: 550px;
        }
        .small-chart-container {
             position: relative;
            width: 100%;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
            height: 350px;
            max-height: 400px;
        }
        .stat-card {
            background-color: white;
            border-radius: 0.75rem;
            padding: 1.5rem;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
            text-align: center;
            border-left: 5px solid #3b82f6;
        }
        .stat-number {
            font-size: 3rem;
            font-weight: 900;
            line-height: 1;
            color: #3b82f6;
        }
        .stat-label {
            font-size: 1rem;
            font-weight: 700;
            color: #4b5563;
            margin-top: 0.5rem;
        }
        h2 {
            font-size: 2.25rem;
            font-weight: 900;
            text-align: center;
            margin-bottom: 0.75rem;
            color: #111827;
        }
        h3 {
           font-size: 1.5rem;
           font-weight: 700;
           text-align: center;
           margin-bottom: 1rem;
           color: #1f2937;
        }
        h4 {
            font-size: 1.25rem;
            font-weight: 700;
            text-align: center;
            margin: 2.5rem 0 1.5rem 0;
            color: #1e40af;
            border-bottom: 2px solid #dbeafe;
            padding-bottom: 0.5rem;
        }
        .section-intro {
            text-align: center;
            color: #4b5563;
            max-width: 48rem;
            margin-left: auto;
            margin-right: auto;
            margin-bottom: 2.5rem;
        }
        .card {
            background-color: white;
            border-radius: 0.75rem;
            padding: 1.5rem;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
            height: 100%;
        }
    </style>
</head>
<body class="text-gray-800">

    <header class="bg-white shadow-md sticky top-0 z-10">
        <div class="container mx-auto px-6 py-4">
            <h1 class="text-3xl font-bold text-gray-900">Analisi Completa Utenti Naga Har (2002-2025)</h1>
            <p class="text-lg text-gray-600">Un report visivo sull'evoluzione dei flussi, dei profili e delle sfide strutturali.</p>
        </div>
    </header>

    <main class="container mx-auto p-6 space-y-16">
        
        <section id="panoramica">
            <p class="section-intro text-xl">Basandosi sui dati completi dal 2002 al 18/09/2025, questa analisi offre uno sguardo panoramico sull'evoluzione del centro Naga Har. Per fornire una visione realistica dei trend, i dati del 2025 sono stati proiettati su base annua per riflettere l'andamento atteso a fine anno.</p>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                <div class="stat-card">
                    <div class="stat-number">17,522</div>
                    <div class="stat-label">Primi Accessi Reali (2002-2025)</div>
                </div>
                 <div class="stat-card">
                    <div class="stat-number">~2,032</div>
                    <div class="stat-label">Accessi Stimati a Fine 2025</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">30.4</div>
                    <div class="stat-label">Età Media Complessiva</div>
                </div>
            </div>
        </section>

        <section id="capitolo1">
            <h2>Capitolo 1: Dinamiche dei Flussi e Operatività</h2>
            <p class="section-intro">L'analisi temporale dei flussi rivela un'intensificazione costante, con picchi legati a eventi globali. La proiezione per il 2025 suggerisce che il trend di crescita si manterrà robusto. L'analisi settimanale, inoltre, mostra come si distribuisce il carico di lavoro del centro nel tempo, con un evidente cambiamento post-pandemia.</p>
            <div class="card mb-8">
                <h3>Andamento Primi Accessi e Età Media (2002-2025)</h3>
                <div class="chart-container">
                    <canvas id="accessiEtaChart"></canvas>
                </div>
                <p class="text-sm text-gray-600 mt-4 text-center">Il grafico mostra l'aumento degli accessi (barre) e l'innalzamento dell'età media (linea). La barra del 2025 è divisa: in blu i dati reali, in azzurro la proiezione fino a fine anno, indicando un potenziale nuovo record di accessi.</p>
            </div>
             <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <div class="card">
                    <h3>Distribuzione Settimanale Accessi (Valori Assoluti per Anno)</h3>
                    <div class="small-chart-container">
                        <canvas id="giorniAssolutiChart"></canvas>
                    </div>
                    <p class="text-sm text-gray-600 mt-4">Il grafico mostra il volume crescente di accessi settimanali. Il drastico calo degli accessi del Lunedì (blu) a partire dal 2020, con una conseguente ridistribuzione del carico sugli altri giorni della settimana, è dovuto alla chiusura di questo turno dopo la pandemia.</p>
                </div>
                 <div class="card">
                    <h3>Distribuzione Settimanale Accessi (Valori Percentuali per Anno)</h3>
                    <div class="small-chart-container">
                        <canvas id="giorniPercentualiChart"></canvas>
                    </div>
                     <p class="text-sm text-gray-600 mt-4">Il peso degli altri giorni cresce dopo la chiusura del lunedì.</p>
                </div>
            </div>
        </section>

        <section id="capitolo2">
            <h2>Capitolo 2: L'Evoluzione del Profilo Demografico</h2>
            <p class="section-intro">Il profilo demografico si trasforma. L'analisi temporale di genere e composizione familiare rivela una lenta ma progressiva transizione da una migrazione prettamente individuale e maschile a modelli che includono sempre più donne e nuclei familiari.</p>
            
            <h4>Il Profilo Aggregato: Una Fotografia (2002-2025)</h4>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                <div class="card"><h3>Genere</h3><div class="small-chart-container"><canvas id="genereChart"></canvas></div></div>
                <div class="card"><h3>Età</h3><div class="small-chart-container"><canvas id="etaChart"></canvas></div></div>
                <div class="card"><h3>Riepilogo Numero di Figli</h3><div class="small-chart-container"><canvas id="figliChart"></canvas></div></div>
            </div>

            <h4>L'Evoluzione del Profilo nel Tempo</h4>
             <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mt-12">
                <div class="card">
                    <h3>Evoluzione delle Fasce d'Età (% sul totale annuo)</h3>
                    <div class="small-chart-container">
                        <canvas id="etaEvoluzioneChart"></canvas>
                    </div>
                     <p class="text-sm text-gray-600 mt-4">La quota di utenti nella fascia 18-30 anni (blu) si riduce, a favore della fascia 31-45 (verde). La popolazione che arriva è sempre più matura.</p>
                </div>
                <div class="card">
                    <h3>Stato Civile Aggregato</h3>
                    <div class="small-chart-container">
                        <canvas id="statoCivileChart"></canvas>
                    </div>
                </div>
            </div>
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mt-12">
                <div class="card">
                    <h3>Distribuzione per Genere (Valori Assoluti per Anno)</h3>
                    <div class="small-chart-container">
                        <canvas id="genereAssolutoChart"></canvas>
                    </div>
                    <p class="text-sm text-gray-600 mt-4">Il grafico mostra la crescita sia della componente maschile (blu) che femminile (viola). Sebbene gli uomini rimangano la maggioranza, il volume di donne è aumentato significativamente.</p>
                </div>
                 <div class="card">
                    <h3>Distribuzione per Genere (Valori Percentuali per Anno)</h3>
                    <div class="small-chart-container">
                        <canvas id="generePercentualeChart"></canvas>
                    </div>
                     <p class="text-sm text-gray-600 mt-4">La vista 100% evidenzia la lenta ma costante crescita della quota femminile sul totale annuo, passata da circa il 10% a picchi vicini al 20% nel periodo più recente.</p>
                </div>
            </div>
        </section>

        <section id="capitolo3">
            <h2>Capitolo 3: Origini, Status e Capitale Umano</h2>
            <p class="section-intro">Le provenienze degli utenti disegnano una mappa delle crisi mondiali. L'analisi temporale, basata sui dati reali, conferma l'intensificarsi dei flussi dall'Africa e dall'Asia. Questo capitolo esplora anche lo status legale e il bagaglio di istruzione delle persone che arrivano.</p>
            
            <h4>Provenienze e Status Legale: Dati Aggregati (2002-2025)</h4>
             <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                 <div class="card">
                    <h3>Principali 10 Nazionalità</h3>
                    <div class="small-chart-container" style="height: 400px;">
                        <canvas id="nazionalitaChart"></canvas>
                    </div>
                </div>
                <div class="card">
                    <h3>Status Giuridico</h3>
                    <div class="small-chart-container" style="height: 400px;">
                        <canvas id="statusGiuridicoChart"></canvas>
                    </div>
                </div>
            </div>

            <h4>Evoluzione delle Provenienze e Status Incrociati</h4>
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mt-12">
                <div class="card">
                    <h3>Flussi delle Principali Nazionalità per Anno (Valori Assoluti)</h3>
                    <div class="small-chart-container">
                        <canvas id="nazionalitaEvoluzioneAssolutaChart"></canvas>
                    </div>
                    <p class="text-sm text-gray-600 mt-4">Questa visualizzazione ad area mostra le "ondate" migratorie: l'onda latinoamericana (es. El Salvador, Perù) e la successiva crescita massiccia delle nazionalità africane e asiatiche. I dati del 2025 non sono proiettati.</p>
                </div>
                 <div class="card">
                    <h3>Flussi delle Principali Nazionalità per Anno (Valori Percentuali)</h3>
                    <div class="small-chart-container">
                        <canvas id="nazionalitaEvoluzionePercentualeChart"></canvas>
                    </div>
                     <p class="text-sm text-gray-600 mt-4">La vista 100% evidenzia ancora meglio il cambiamento strutturale.</p>
                </div>
            </div>
            <div class="card mt-12">
                <h3>Status Giuridico per Principali Nazionalità (Aggregato 2002-2025)</h3>
                <div class="chart-container" style="height: 500px;">
                    <canvas id="statusPerNazioneChart"></canvas>
                </div>
                <p class="text-sm text-gray-600 mt-4 text-center">Lo status varia con la nazionalità. Eritrei e Ivoriani hanno alte percentuali di protezione. Peruviani ed Egiziani, invece, hanno una quota enorme di persone che non hanno ancora presentato domanda, indicando percorsi migratori diversi dall'asilo.</p>
            </div>

            <h4>Il Capitale Umano: Livello di Istruzione</h4>
             <div class="grid grid-cols-1 md:grid-cols-2 gap-8 mt-12">
                <div class="card">
                    <h3>Livello di Scolarità (Aggregato)</h3>
                     <div class="small-chart-container">
                        <canvas id="scolaritaChart"></canvas>
                    </div>
                </div>
                <div class="card">
                    <h3>Evoluzione Livello di Scolarità (% sul totale annuo)</h3>
                     <div class="small-chart-container">
                        <canvas id="scolaritaEvoluzioneChart"></canvas>
                    </div>
                    <p class="text-sm text-gray-600 mt-4">Si nota una tendenza positiva: la quota di persone con laurea (blu) e diploma di medie superiori (verde) è aumentata nel tempo, mentre la percentuale di analfabeta (rosso) è in calo.</p>
                </div>
            </div>
        </section>

    </main>

    <footer class="bg-gray-900 text-white mt-12">
        <div class="container mx-auto px-6 py-4 text-center">
            <p>Report generato sull'analisi dei dati di afflusso al Centro Naga Har, 2002-2025.</p>
            <p class="text-sm text-gray-400">Visualizzazione a scopo illustrativo basata sui dati forniti.</p>
        </div>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const FONT_COLOR = '#1f2937';
            const GRID_COLOR = '#e5e7eb';
            const CHART_COLORS = ['#3b82f6', '#10b981', '#ef4444', '#f97316', '#8b5cf6', '#ec4899', '#64748b', '#f59e0b', '#34d399', '#a78bfa', '#06b6d4', '#d946ef'];
            const YEARS = Array.from({ length: 24 }, (_, i) => 2002 + i);

            const tooltipTitleCallback = (tooltipItems) => {
                const item = tooltipItems[0];
                let label = item.chart.data.labels[item.dataIndex];
                if (Array.isArray(label)) return label.join(' ');
                return label;
            };

            const defaultBarOptions = (indexAxis = 'x', stacked = false) => ({
                responsive: true, maintainAspectRatio: false, indexAxis,
                plugins: { legend: { labels: { color: FONT_COLOR } }, tooltip: { callbacks: { title: tooltipTitleCallback }, mode: 'index', intersect: false } },
                scales: { x: { ticks: { color: FONT_COLOR }, grid: { color: GRID_COLOR }, stacked }, y: { ticks: { color: FONT_COLOR }, grid: { color: GRID_COLOR }, stacked } },
                interaction: { mode: 'index', intersect: false }
            });

             const defaultAreaOptions = (stacked = false, is100 = false) => {
                const options = {
                    responsive: true, maintainAspectRatio: false,
                    plugins: { legend: { labels: { color: FONT_COLOR } }, tooltip: { callbacks: { title: tooltipTitleCallback }, mode: 'index', intersect: false } },
                    scales: { x: { ticks: { color: FONT_COLOR }, grid: { color: GRID_COLOR } }, y: { ticks: { color: FONT_COLOR }, grid: { color: GRID_COLOR }, stacked: stacked } },
                    elements: { line: { tension: 0.3 }, point: { radius: 0 } },
                    interaction: { mode: 'index', intersect: false }
                };
                if(is100) {
                    options.scales.y.max = 100;
                    options.scales.y.ticks.callback = value => Math.round(value) + '%';
                }
                return options;
            };

            const defaultPieOptions = { responsive: true, maintainAspectRatio: false, plugins: { legend: { position: 'top', labels: { color: FONT_COLOR } }, tooltip: { callbacks: { title: tooltipTitleCallback } } } };
            
            const projectionFactor = 365 / 261; 
            const projectValue = (value) => Math.round(value * projectionFactor);

            // CAP 1: FLUSSI
            const accessiData = [297, 648, 385, 417, 562, 503, 453, 622, 521, 611, 504, 566, 506, 860, 1089, 1187, 854, 818, 316, 481, 752, 1339, 1717, 1453];
            const accessiProjected2025 = projectValue(accessiData[accessiData.length - 1]);
            const accessiDelta2025 = accessiProjected2025 - accessiData[accessiData.length - 1];
            const accessiDataForChart_real = [...accessiData];
            const accessiDataForChart_delta = [...new Array(accessiData.length - 1).fill(0), accessiDelta2025];
            const etaMediaData = [29.1, 27.95, 28.17, 27.06, 27.68, 27.08, 27.91, 27.8, 28.21, 28.11, 28.19, 29.22, 28.48, 28.31, 28.14, 29.42, 29.21, 31.1, 32.23, 33.48, 32.76, 33.59, 34.41, 34.6];
            
            new Chart(document.getElementById('accessiEtaChart'), {
                type: 'bar',
                data: {
                    labels: YEARS,
                    datasets: [
                        { type: 'line', label: 'Età Media', data: etaMediaData, borderColor: CHART_COLORS[1], yAxisID: 'y1', tension: 0.3, fill: false, order: 0 },
                        { label: 'Accessi Reali', data: accessiDataForChart_real, backgroundColor: CHART_COLORS[0], yAxisID: 'y', order: 1, stack: 'accessi' },
                        { label: 'Proiezione Fine Anno', data: accessiDataForChart_delta, backgroundColor: '#a5b4fc', yAxisID: 'y', order: 1, stack: 'accessi' }
                    ]
                },
                options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { position: 'top' }, tooltip: { mode: 'index', intersect: false } }, scales: { x: { stacked: true }, y: { type: 'linear', display: true, position: 'left', title: { display: true, text: 'Numero Accessi' }, stacked: true }, y1: { type: 'linear', display: true, position: 'right', grid: { drawOnChartArea: false }, title: { display: true, text: 'Età Media' } } } }
            });
            
            const giorniData = {
                lun: [43, 140, 101, 118, 109, 87, 116, 126, 113, 114, 111, 127, 114, 154, 222, 219, 161, 150, 4, 1, 3, 3, 2, 2],
                mar: [59, 132, 62, 104, 106, 107, 70, 119, 101, 121, 101, 109, 104, 165, 201, 221, 172, 162, 59, 90, 134, 252, 340, 249],
                mer: [60, 137, 65, 71, 123, 111, 108, 127, 107, 120, 97, 122, 100, 177, 212, 240, 162, 170, 71, 102, 155, 269, 360, 284],
                gio: [32, 76, 62, 60, 85, 77, 60, 104, 76, 99, 80, 88, 77, 140, 179, 189, 125, 122, 45, 71, 109, 199, 259, 206],
                ven: [83, 133, 80, 56, 75, 84, 82, 117, 98, 125, 91, 102, 94, 181, 228, 257, 182, 164, 68, 107, 163, 298, 355, 281]
            };
            new Chart(document.getElementById('giorniAssolutiChart'), { type: 'line', data: { labels: YEARS, datasets: Object.keys(giorniData).map((g, i) => ({ label: g.charAt(0).toUpperCase() + g.slice(1), data: giorniData[g], borderColor: CHART_COLORS[i], backgroundColor: CHART_COLORS[i] + '80', fill: true })) }, options: defaultAreaOptions(true, false) });
            const giorniPercentualiData = YEARS.map((_, i) => { const total = Object.values(giorniData).reduce((sum, day) => sum + day[i], 0); return total === 0 ? { lun: 0, mar: 0, mer: 0, gio: 0, ven: 0 } : { lun: (giorniData.lun[i] / total) * 100, mar: (giorniData.mar[i] / total) * 100, mer: (giorniData.mer[i] / total) * 100, gio: (giorniData.gio[i] / total) * 100, ven: (giorniData.ven[i] / total) * 100 }; });
            new Chart(document.getElementById('giorniPercentualiChart'), { type: 'line', data: { labels: YEARS, datasets: Object.keys(giorniData).map((g, i) => ({ label: g.charAt(0).toUpperCase() + g.slice(1), data: giorniPercentualiData.map(d => d[g]), borderColor: CHART_COLORS[i], backgroundColor: CHART_COLORS[i] + '80', fill: true })) }, options: defaultAreaOptions(true, true) });

            // CAP 2: DEMOGRAFIA
            new Chart(document.getElementById('genereChart'), { type: 'doughnut', data: { labels: ['Uomini', 'Donne'], datasets: [{ data: [15545, 1976], backgroundColor: [CHART_COLORS[0], CHART_COLORS[5]] }] }, options: defaultPieOptions });
            new Chart(document.getElementById('etaChart'), { type: 'bar', data: { labels: ['0-17', '18-30', '31-45', '46-60', '60+'], datasets: [{ label: 'Utenti', data: [333, 10738, 5137, 1488, 251], backgroundColor: CHART_COLORS[0] }] }, options: defaultBarOptions() });
            new Chart(document.getElementById('statoCivileChart'), { type: 'pie', data: { labels: ['Celibe/Nubile', 'Coniugato/a', 'Altro/Non Spec.'], datasets: [{ data: [12128, 4403, 991], backgroundColor: [CHART_COLORS[0], CHART_COLORS[1], CHART_COLORS[6]] }] }, options: defaultPieOptions });
            new Chart(document.getElementById('figliChart'), { type: 'doughnut', data: { labels: ['0 Figli', '1 Figlio', '2 Figli', '3+ Figli'], datasets: [{ data: [12282, 1618, 1272, 2070], backgroundColor: [CHART_COLORS[0], CHART_COLORS[1], CHART_COLORS[3], CHART_COLORS[4]] }] }, options: defaultPieOptions });
            const etaAnnoData = [[10, 178, 93, 8, 0], [18, 424, 183, 7, 0], [17, 234, 122, 6, 1], [13, 296, 99, 4, 0], [5, 430, 114, 11, 1], [17, 348, 124, 4, 0], [11, 305, 121, 10, 2], [8, 446, 142, 18, 1], [15, 350, 137, 13, 0], [17, 375, 193, 20, 2], [8, 301, 173, 17, 1], [11, 348, 188, 14, 1], [10, 281, 191, 20, 1], [27, 513, 282, 29, 3], [37, 650, 360, 37, 2], [41, 696, 408, 38, 3], [32, 427, 351, 37, 4], [22, 367, 383, 40, 2], [7, 107, 177, 23, 2], [9, 159, 274, 35, 4], [16, 321, 370, 42, 3], [24, 620, 629, 61, 2], [35, 786, 788, 96, 5], [21, 626, 725, 75, 4]];
            const etaPercentuale = etaAnnoData.map(row => { const total = row.reduce((s, c) => s + c, 1); return row.map(v => (v / total) * 100); });
            new Chart(document.getElementById('etaEvoluzioneChart'), { type: 'bar', data: { labels: YEARS, datasets: [{ label: '18-30', data: etaPercentuale.map(r => r[1]), backgroundColor: CHART_COLORS[0] }, { label: '31-45', data: etaPercentuale.map(r => r[2]), backgroundColor: CHART_COLORS[1] }] }, options: { ...defaultBarOptions('x', true), interaction: { mode: 'index', intersect: false } } });
            const genereData = { f: [34, 62, 44, 34, 55, 42, 34, 41, 44, 36, 26, 26, 32, 59, 94, 110, 87, 91, 44, 68, 127, 235, 290, 246], m: [263, 586, 341, 383, 506, 461, 419, 581, 475, 574, 475, 539, 473, 800, 994, 1076, 767, 725, 271, 412, 625, 1104, 1426, 1206] };
            new Chart(document.getElementById('genereAssolutoChart'), { type: 'line', data: { labels: YEARS, datasets: [{ label: 'Donne', data: genereData.f, borderColor: CHART_COLORS[5], backgroundColor: CHART_COLORS[5] + '80', fill: true }, { label: 'Uomini', data: genereData.m, borderColor: CHART_COLORS[0], backgroundColor: CHART_COLORS[0] + '80', fill: true }] }, options: defaultAreaOptions(true, false) });
            const generePercentualeData = YEARS.map((_, i) => { const total = genereData.f[i] + genereData.m[i]; return total === 0 ? { f: 0, m: 0 } : { f: (genereData.f[i] / total) * 100, m: (genereData.m[i] / total) * 100 }; });
            new Chart(document.getElementById('generePercentualeChart'), { type: 'line', data: { labels: YEARS, datasets: [{ label: 'Donne', data: generePercentualeData.map(d => d.f), borderColor: CHART_COLORS[5], backgroundColor: CHART_COLORS[5] + '80', fill: true }, { label: 'Uomini', data: generePercentualeData.map(d => d.m), borderColor: CHART_COLORS[0], backgroundColor: CHART_COLORS[0] + '80', fill: true }] }, options: defaultAreaOptions(true, true) });

            // CAP 3: ORIGINI
            new Chart(document.getElementById('nazionalitaChart'), { type: 'bar', data: { labels: ['El Salvador', 'Perù', 'Nigeria', 'Egitto', 'Pakistan', 'Bangladesh', 'Gambia', 'Mali', "Costa d'Avorio", 'Eritrea'], datasets: [{ label: 'Utenti', data: [1054, 988, 925, 817, 701, 652, 632, 592, 584, 570], backgroundColor: CHART_COLORS[0] }] }, options: defaultBarOptions('y') });
            new Chart(document.getElementById('statusGiuridicoChart'), { type: 'doughnut', data: { labels: ['Richiedente Asilo', 'Titolare Protezione', 'Nessuna Domanda', 'Altro'], datasets: [{ data: [6886, 4608, 3957, 2071], backgroundColor: CHART_COLORS }] }, options: defaultPieOptions });
            
            const nazionalitaAnnoData = {
                'Bangladesh': [1,5,5,4,15,33,24,18,20,48,33,53,39,60,54,39,39,19,18,21,26,25,67,68],
                'Costa d\'Avorio': [2,32,20,103,51,19,36,40,39,53,35,45,29,63,60,54,37,9,7,8,7,9,4,7],
                'Egitto': [0,1,1,0,1,0,2,4,4,8,17,11,14,12,14,24,21,19,6,43,109,375,239,251],
                'El Salvador': [1,0,0,0,0,0,2,3,6,2,2,10,9,39,61,115,104,159,43,49,59,71,61,40],
                'Eritrea': [50,105,89,55,103,82,23,62,44,18,12,11,26,22,14,11,3,5,1,2,0,6,6,1],
                'Gambia': [3,16,21,11,29,30,34,98,52,33,18,16,31,66,110,96,68,43,25,18,17,21,8,10],
                'Mali': [0,0,2,2,5,3,6,21,10,30,61,77,48,102,123,141,53,36,12,18,12,22,8,3],
                'Nigeria': [7,35,21,21,96,82,55,50,33,48,42,41,48,50,104,143,108,91,35,69,47,26,19,16],
                'Pakistan': [0,1,0,2,6,9,40,44,34,28,31,31,33,92,93,52,47,62,26,52,70,42,55,54],
                'Perù': [0,0,0,0,0,1,0,1,0,0,0,2,1,2,1,4,17,63,23,25,137,411,589,492],
                'Altro': [197,423,194,180,222,192,181,218,245,288,192,194,180,260,366,375,232,162,77,107,204,242,518,425]
            };
            new Chart(document.getElementById('nazionalitaEvoluzioneAssolutaChart'), { type: 'line', data: { labels: YEARS, datasets: Object.keys(nazionalitaAnnoData).map((n, i) => ({ label: n, data: nazionalitaAnnoData[n], borderColor: CHART_COLORS[i % CHART_COLORS.length], backgroundColor: CHART_COLORS[i % CHART_COLORS.length] + '80', fill: true })) }, options: defaultAreaOptions(true, false) });
            const nazionalitaPercentuali = YEARS.map((_, i) => { const total = Object.values(nazionalitaAnnoData).reduce((sum, n) => sum + n[i], 0); return total === 0 ? {} : Object.fromEntries(Object.keys(nazionalitaAnnoData).map(n => [n, (nazionalitaAnnoData[n][i] / total) * 100])) });
            new Chart(document.getElementById('nazionalitaEvoluzionePercentualeChart'), { type: 'line', data: { labels: YEARS, datasets: Object.keys(nazionalitaAnnoData).map((n, i) => ({ label: n, data: nazionalitaPercentuali.map(d => d[n]), borderColor: CHART_COLORS[i % CHART_COLORS.length], backgroundColor: CHART_COLORS[i % CHART_COLORS.length] + '80', fill: true })) }, options: defaultAreaOptions(true, true) });

            const statusPerNazioneData = { labels: ["Costa d'Avorio", 'Eritrea', 'Mali', 'Nigeria', 'Gambia', 'Pakistan', 'Bangladesh', 'El Salvador', 'Egitto', 'Perù'], datasets: [ { label: 'Titolare Protezione', data: [363, 373, 282, 179, 143, 120, 67, 17, 24, 8], backgroundColor: CHART_COLORS[1] }, { label: 'Richiedente Asilo', data: [244, 245, 275, 594, 405, 418, 378, 408, 437, 448], backgroundColor: CHART_COLORS[0] }, { label: 'Nessuna Domanda', data: [35, 18, 35, 114, 57, 114, 107, 240, 443, 927], backgroundColor: CHART_COLORS[2] }] };
            new Chart(document.getElementById('statusPerNazioneChart'), { type: 'bar', data: statusPerNazioneData, options: defaultBarOptions('y', true) });
            
            new Chart(document.getElementById('scolaritaChart'), { type: 'bar', data: { labels: ['Medie Sup.', 'Medie Inf.', 'Elementare', 'Analfabeta', 'Laurea', 'Non Spec.'], datasets: [{ label: 'Utenti', data: [5482, 4245, 3344, 1955, 1482, 1011], backgroundColor: CHART_COLORS[1] }] }, options: defaultBarOptions() });
            const scolaritaAnnoData = [[12,35,32,56,79,83], [61,148,30,121,238,50], [33,75,39,83,135,20], [77,73,38,83,138,8], [56,132,62,125,180,7], [55,108,54,98,176,12], [47,88,40,87,157,24], [56,92,45,102,213,114], [40,84,41,85,187,84], [37,86,50,96,214,128], [37,79,44,89,161,94], [31,76,36,84,203,136], [29,66,50,66,177,118], [58,103,75,137,276,211], [64,136,89,150,377,273], [75,138,94,182,452,246], [45,110,79,116,323,181], [53,95,89,109,305,167], [22,46,33,43,120,52], [30,75,57,51,199,69], [53,115,70,93,311,110], [103,184,121,173,569,189], [121,232,148,222,765,229], [100,166,119,166,693,209]];
            const scolaritaPercentuale = scolaritaAnnoData.map(row => { const total = row.reduce((s, c) => s + c, 1); return row.map(v => (v / total) * 100); });
            new Chart(document.getElementById('scolaritaEvoluzioneChart'), { type: 'line', data: { labels: YEARS, datasets: [{ label: 'Laurea', data: scolaritaPercentuale.map(r => r[2]), borderColor: CHART_COLORS[0], fill: false }, { label: 'Medie Sup.', data: scolaritaPercentuale.map(r => r[4]), borderColor: CHART_COLORS[1], fill: false }, { label: 'Analfabeta', data: scolaritaPercentuale.map(r => r[0]), borderColor: CHART_COLORS[2], fill: false }] }, options: defaultBarOptions() });

        });
    </script>
</body>
</html>

